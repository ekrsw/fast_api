# プロジェクト概要

## プロジェクト名
**My FastAPI Project**

## 概要
`My FastAPI Project`は、Pythonの高速なWebフレームワークであるFastAPIを基盤とした、堅牢でスケーラブルなAPIサーバーの構築を目的としたプロジェクトです。本プロジェクトは、ユーザー認証、アイテム管理、ユーザー管理機能を備え、セキュアな認証メカニズムと非同期データベース操作を活用しています。また、DockerおよびNginxを用いたコンテナ化とリバースプロキシ設定により、容易なデプロイメントとスケーラビリティを実現しています。

## 主な特徴

1. **ユーザー認証と認可**
   - OAuth2をベースとしたJWT（JSON Web Token）による認証システム。
   - アクセストークンとリフレッシュトークンの発行・更新機能。
   - 管理者権限を持つユーザーの管理機能。

2. **CRUD操作**
   - ユーザーおよびアイテムに対するCreate, Read, Update, Delete操作の実装。
   - ページング機能を備えたデータ取得。

3. **データベース管理**
   - 非同期対応のSQLAlchemyを使用したPostgreSQLデータベースとの連携。
   - データベースモデルの自動マイグレーション機能。

4. **セキュリティ**
   - パスワードのハッシュ化（bcrypt）による安全な保存。
   - 環境変数を利用したシークレットキーの管理。

5. **コンテナ化とデプロイメント**
   - DockerおよびDocker Composeを用いたマルチコンテナ環境の構築。
   - Nginxをリバースプロキシとして設定し、APIへのアクセスを最適化。

## プロジェクト構成

```
my_fastapi_project/
├── app/
│   ├── routers
│   │   ├── auth.py        # 認証関連のルーター
│   │   ├── items.py       # アイテム管理のルーター
│   │   └── users.py       # ユーザー管理のルーター
│   ├── __init__.py
│   ├── auth.py            # 認証ロジック
│   ├── config.py          # 設定管理
│   ├── create_admin.py    # 初期管理者作成スクリプト
│   ├── crud.py            # CRUD操作の実装
│   ├── database.py        # データベース接続設定
│   ├── dependencies.py    # 依存関係の定義
│   ├── main.py            # アプリケーションのエントリーポイント
│   ├── models.py          # データベースモデル
│   └── schemas.py         # Pydanticスキーマ
├── docker/
│   ├── Dockerfile         # APIサーバーのDocker設定
│   └── nginx.conf         # Nginxの設定ファイル
├── docker-compose.yml     # Docker Compose設定
├── requirements.txt       # Python依存関係
└── README.md              # プロジェクトの説明書
```

### 各ディレクトリおよびファイルの役割

- **app/**: アプリケーションの主要なソースコードを含むディレクトリ。
  - **routers/**: 各機能（認証、アイテム、ユーザー）に対応するルーターを配置。
  - **auth.py**: 認証に関連する関数（パスワード検証、JWTトークン生成など）を実装。
  - **config.py**: 環境変数を管理し、設定をPydanticモデルとして定義。
  - **create_admin.py**: 初期管理者ユーザーをデータベースに作成するスクリプト。
  - **crud.py**: データベース操作（ユーザーおよびアイテムのCRUD）を実装。
  - **database.py**: データベース接続エンジンとセッションを設定。
  - **dependencies.py**: FastAPIの依存関係（例: データベースセッション）を定義。
  - **main.py**: FastAPIアプリケーションの起動設定とルーターの登録。
  - **models.py**: SQLAlchemyを使用したデータベースモデルの定義。
  - **schemas.py**: Pydanticを使用したリクエストおよびレスポンスのスキーマ定義。

- **docker/**: コンテナ化に関連する設定ファイルを含むディレクトリ。
  - **Dockerfile**: APIサーバーのDockerイメージをビルドするための設定。
  - **nginx.conf**: Nginxのリバースプロキシ設定。

- **docker-compose.yml**: マルチコンテナ環境（データベース、APIサーバー、Nginx）の構成を定義。

- **requirements.txt**: プロジェクトで使用するPythonパッケージの一覧。

- **README.md**: プロジェクトの概要、セットアップ手順、使用方法などのドキュメント。

## テクノロジースタック

- **Python 3.11**: プログラミング言語。
- **FastAPI**: 高速なWebフレームワーク。
- **SQLAlchemy (Async)**: ORMライブラリによるデータベース操作。
- **PostgreSQL**: データベース管理システム。
- **Docker & Docker Compose**: コンテナ化およびマルチコンテナオーケストレーション。
- **Nginx**: リバースプロキシおよびロードバランサー。
- **JWT (JSON Web Token)**: 認証トークンの生成と検証。
- **Pydantic**: データバリデーションと設定管理。

## セットアップとデプロイメント

1. **環境変数の設定**
   - `.env` ファイルに必要な設定（データベース接続情報、JWTシークレットキー、初期管理者ユーザー情報など）を記述。

2. **Docker環境の構築**
   - DockerおよびDocker Composeをインストール。
   - プロジェクトルートで以下のコマンドを実行してコンテナをビルドおよび起動。
     ```bash
     docker-compose up --build
     ```

3. **初期管理者ユーザーの作成**
   - APIサーバーが起動した後、`create_admin.py` スクリプトを実行して初期管理者ユーザーをデータベースに作成。
     ```bash
     docker-compose exec api python -m app.create_admin
     ```

4. **APIの利用**
   - Nginxがリバースプロキシとして設定されているため、ブラウザまたはAPIクライアントから `http://localhost:8080` でAPIにアクセス可能。

## APIエンドポイント

### 認証関連
- `POST /auth/token`: ユーザー認証を行い、アクセストークンとリフレッシュトークンを発行。
- `POST /auth/refresh`: リフレッシュトークンを使用して新しいアクセストークンを発行。

### ユーザー管理
- `POST /users/`: 新しいユーザーを登録。
- `GET /users/`: ユーザー一覧を取得。
- `GET /users/{username}`: 特定のユーザー情報を取得。
- `PUT /users/{username}`: ユーザー情報を更新。
- `DELETE /users/{username}`: ユーザーを削除。

### アイテム管理
- `POST /items/`: 新しいアイテムを作成。
- `GET /items/`: アイテム一覧を取得。
- `GET /items/{item_id}`: 特定のアイテム情報を取得。
- `PUT /items/{item_id}`: アイテム情報を更新。
- `DELETE /items/{item_id}`: アイテムを削除。

## セキュリティ対策

- **パスワードハッシュ化**: ユーザーパスワードはbcryptを使用してハッシュ化し、安全に保存。
- **JWTトークン**: アクセストークンとリフレッシュトークンにより、セッション管理と認証を実現。
- **環境変数管理**: `.env` ファイルにシークレットキーやデータベースパスワードを保存し、ソースコードにハードコードしない。

## 開発と拡張性

- **モジュラー設計**: 各機能（認証、ユーザー管理、アイテム管理）が独立したルーターとして実装されており、機能追加や修正が容易。
- **非同期処理**: SQLAlchemyの非同期機能を活用し、高いパフォーマンスを実現。
- **テスト対応**: 各モジュールが分離されているため、ユニットテストや統合テストの実装が容易。
- **ドキュメンテーション**: FastAPIの自動生成ドキュメント（Swagger UI）により、APIの仕様が明確に可視化。

## 今後の展望

- **ロギングとモニタリング**: アプリケーションのパフォーマンスやエラーを監視するためのロギング機能の強化。
- **スケーリング**: Kubernetesなどのオーケストレーションツールを用いた水平スケーリングの導入。
- **テストの拡充**: エンドツーエンドのテストやCI/CDパイプラインの構築。
- **機能追加**: ロールベースのアクセス制御、ファイルアップロード機能、通知システムなどの追加。

## まとめ

`My FastAPI Project`は、FastAPIと最新の技術スタックを活用し、高性能かつセキュアなAPIサーバーの構築を目指しています。コンテナ化された環境とモジュラー設計により、開発からデプロイメントまでのプロセスを効率化し、将来的な拡張やメンテナンスを容易にします。本プロジェクトは、スケーラブルなWebサービスの基盤として、多様な用途に対応可能です。